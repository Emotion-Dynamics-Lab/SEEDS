---
title: "PERMA Profiler"
author: "Minju Yu - Gizem Keskin is checking and editing on 2024-06-05"
date: "2022-11-13"
output:
  html_document:
    number_sections: yes
    toc: yes
    toc_depth: 3
    toc_float: yes
---

## Preliminary Steps

Load packages:
```{r, warning = FALSE, message = FALSE}
library(dplyr)
library(tidyverse)
library(Hmisc)
library(psych)
library(ggplot2)
library(ggcorrplot)
library(reshape2)
```

Read in the data:
```{r}
#Gizem's PC
df <- read.csv("P:/VERSUS (UGS3)/Data/Part 1/ExpiWell Data Term 1 Cleaned.csv", na.strings=c("","NA"))

# Minju's PC
#df <- read.csv("P:\\Emotion Dynamics Lab\\VERSUS (UGS3)\\Data\\Part 1\\ExpiWell Data Term 1 Cleaned.csv", na.strings=c("","NA"))

# Jess's Mac
# df <- read.csv("/Volumes/research/Emotion Dynamics Lab/VERSUS (UGS3)/Data/Part 1/ExpiWell Data Term 1 Cleaned.csv", na.strings=c("","NA"))
```

Subset the data to just the items from the PERMA Profiler and remove the rows that have question headers:
```{r}
df_scale <- select(df [-c(1,2,3),], X.5, X..Q...Q112.ChoiceTextEntryValue..:X..Q...Q134.ChoiceTextEntryValue..)
head(df_scale)
```

Rename the items:
```{r}
colnames(df_scale)[colnames(df_scale)=="X.5"] <- "id"
colnames(df_scale)[colnames(df_scale)=="X..Q...Q112.ChoiceTextEntryValue.."] <- "perma_1"
colnames(df_scale)[colnames(df_scale)=="X..Q...Q113.ChoiceTextEntryValue.."] <- "perma_2"
colnames(df_scale)[colnames(df_scale)=="X..Q...Q114.ChoiceTextEntryValue.."] <- "perma_3"
colnames(df_scale)[colnames(df_scale)=="X..Q...Q115.ChoiceTextEntryValue.."] <- "perma_4"
colnames(df_scale)[colnames(df_scale)=="X..Q...Q116.ChoiceTextEntryValue.."] <- "perma_5"
colnames(df_scale)[colnames(df_scale)=="X..Q...Q117.ChoiceTextEntryValue.."] <- "perma_6"
colnames(df_scale)[colnames(df_scale)=="X..Q...Q118.ChoiceTextEntryValue.."] <- "perma_7"
colnames(df_scale)[colnames(df_scale)=="X..Q...Q119.ChoiceTextEntryValue.."] <- "perma_8"
colnames(df_scale)[colnames(df_scale)=="X..Q...Q120.ChoiceTextEntryValue.."] <- "perma_9"
colnames(df_scale)[colnames(df_scale)=="X..Q...Q121.ChoiceTextEntryValue.."] <- "perma_10"
colnames(df_scale)[colnames(df_scale)=="X..Q...Q122.ChoiceTextEntryValue.."] <- "perma_11"
colnames(df_scale)[colnames(df_scale)=="X..Q...Q123.ChoiceTextEntryValue.."] <- "perma_12"
colnames(df_scale)[colnames(df_scale)=="X..Q...Q124.ChoiceTextEntryValue.."] <- "perma_13"
colnames(df_scale)[colnames(df_scale)=="X..Q...Q125.ChoiceTextEntryValue.."] <- "perma_14"
colnames(df_scale)[colnames(df_scale)=="X..Q...Q126.ChoiceTextEntryValue.."] <- "perma_15"
colnames(df_scale)[colnames(df_scale)=="X..Q...Q127.ChoiceTextEntryValue.."] <- "perma_16"
colnames(df_scale)[colnames(df_scale)=="X..Q...Q128.ChoiceTextEntryValue.."] <- "perma_17"
colnames(df_scale)[colnames(df_scale)=="X..Q...Q129.ChoiceTextEntryValue.."] <- "perma_18"
colnames(df_scale)[colnames(df_scale)=="X..Q...Q130.ChoiceTextEntryValue.."] <- "perma_19"
colnames(df_scale)[colnames(df_scale)=="X..Q...Q131.ChoiceTextEntryValue.."] <- "perma_20"
colnames(df_scale)[colnames(df_scale)=="X..Q...Q132.ChoiceTextEntryValue.."] <- "perma_21"
colnames(df_scale)[colnames(df_scale)=="X..Q...Q133.ChoiceTextEntryValue.."] <- "perma_22"
colnames(df_scale)[colnames(df_scale)=="X..Q...Q134.ChoiceTextEntryValue.."] <- "perma_23"
```

Convert the "prefer not to respond" options to "NA":
```{r}
df_scale[df_scale == 11] <- NA
```

Variables are pulled in as factors and we want to make them numeric values: 
```{r}
df_scale[,paste0("perma_",1:23)] <- lapply(df_scale[,paste0("perma_",1:23)], as.numeric)
str(df_scale)
```

Label the items:
```{r}
label(df_scale[["perma_1"]]) <- "How much of the time do you feel you are making progress towards accomplishing your goals?"
label(df_scale[["perma_2"]]) <- "How often do you become absorbed in what you are doing?"
label(df_scale[["perma_3"]]) <- "In general, how often do you feel joyful?"
label(df_scale[["perma_4"]]) <- "In general, how often do you feel anxious?"
label(df_scale[["perma_5"]]) <- "How often do you achieve the important goals you have set for yourself?"
label(df_scale[["perma_6"]]) <- "In general, how would you say your health is?"
label(df_scale[["perma_7"]]) <- "In general, to what extent do you lead a purposeful and meaningful life?"
label(df_scale[["perma_8"]]) <- "To what extent do you receive help and support from others when you need it?"
label(df_scale[["perma_9"]]) <- "In general, to what extent do you feel that what you do in your life is valuable and worthwhile?"
label(df_scale[["perma_10"]]) <- "In general, to what extent do you feel excited and interested in things?"
label(df_scale[["perma_11"]]) <- "How lonely do you feel in your daily life?"
label(df_scale[["perma_12"]]) <- "How satisfied are you with your current physical health?"
label(df_scale[["perma_13"]]) <- "In general, how often do you feel positive?"
label(df_scale[["perma_14"]]) <- "In general, how often do you feel angry?"
label(df_scale[["perma_15"]]) <- "How often are you able to handle your responsibilities?"
label(df_scale[["perma_16"]]) <- "In general, how often do you feel sad?"
label(df_scale[["perma_17"]]) <- "How often do you lose track of time while doing something you enjoy?"
label(df_scale[["perma_18"]]) <- "Compared to others of your same age and sex, how is your health?"
label(df_scale[["perma_19"]]) <- "To what extent do you feel loved?"
label(df_scale[["perma_20"]]) <- "To what extent do you generally feel you have a sense of direction in your life?"
label(df_scale[["perma_21"]]) <- "How satisfied are you with your personal relationships?"
label(df_scale[["perma_22"]]) <- "In general, to what extent do you feel contented?"
label(df_scale[["perma_23"]]) <- "Taking all things together, how happy would you say you are?"

# Look at the data
head(df_scale)
```

## Calculate the scales

### Calculate the standard mean and sum of subscales

Calculate the mean scores of PERMA Profiler and Subscales, in line with the instructions described in the [instruction manual](https://www.peggykern.org/uploads/5/6/6/7/56678211/the_PERMA-profiler_101416.pdf).

Positive Emotion subscale:
```{r}
df_scale <- mutate (df_scale, perma_positive_sum = perma_3 + perma_13 + perma_22)
df_scale$perma_positive_mean <- apply(df_scale[, c("perma_3", "perma_13", "perma_22")], 1, mean)

label(df_scale[["perma_positive_sum"]]) <- "sum of PERMA positive emotion items"
label(df_scale[["perma_positive_mean"]]) <- "mean of PERMA positive emotion items"
```

Engagement subscale:
```{r}
df_scale <- mutate (df_scale, perma_engagement_sum = perma_2 + perma_10 + perma_17)
df_scale$perma_engagement_mean <- apply(df_scale[, c("perma_2", "perma_10", "perma_17")], 1, mean)

label(df_scale[["perma_engagement_sum"]]) <- "sum of PERMA engagement items"
label(df_scale[["perma_engagement_mean"]]) <- "mean of PERMA engagement items"
```

Relationships subscale:
```{r}
df_scale <- mutate (df_scale, perma_relationships_sum = perma_8 + perma_19 + perma_21)
df_scale$perma_relationships_mean <- apply(df_scale[, c("perma_8", "perma_19", "perma_21")], 1, mean)

label(df_scale[["perma_relationships_sum"]]) <- "sum of PERMA relationships items"
label(df_scale[["perma_relationships_mean"]]) <- "mean of PERMA relationships items"
```

Meaning subscale:
```{r}
df_scale <- mutate (df_scale, perma_meaning_sum = perma_7 + perma_9 + perma_20)
df_scale$perma_meaning_mean <- apply(df_scale[, c("perma_7", "perma_9", "perma_20")], 1, mean)

label(df_scale[["perma_meaning_sum"]]) <- "sum of PERMA meaning items"
label(df_scale[["perma_meaning_mean"]]) <- "mean of PERMA meaning items"
```

Accomplishment subscale:
```{r}
df_scale <- mutate (df_scale, perma_accomplishment_sum = perma_1 + perma_5 + perma_15)
df_scale$perma_accomplishment_mean <- apply(df_scale[, c("perma_1", "perma_5", "perma_15")], 1, mean)

label(df_scale[["perma_accomplishment_sum"]]) <- "sum of PERMA accomplishment items"
label(df_scale[["perma_accomplishment_mean"]]) <- "mean of PERMA accomplishment items"
```

Overall well-being subscale:
```{r}
df_scale <- mutate (df_scale, perma_wellbeing_sum = perma_3 + perma_13 + perma_22 + perma_2 + perma_10 + perma_17 + perma_8 + perma_19 + perma_21 + perma_7 + perma_9 + perma_20 + perma_1 + perma_5 + perma_15 + perma_23)
df_scale$perma_wellbeing_mean <- apply(df_scale[, c("perma_3", "perma_13", "perma_22", "perma_2", "perma_10", "perma_17", "perma_8", "perma_19", "perma_21", "perma_7", "perma_9", "perma_20", "perma_1", "perma_5", "perma_15", "perma_23")], 1, mean)

label(df_scale[["perma_wellbeing_sum"]]) <- "sum of PERMA overall wellbeing items"
label(df_scale[["perma_wellbeing_mean"]]) <- "mean of PERMA overall wellbeing items"
```

Negative Emotion subscale:
```{r}
df_scale <- mutate (df_scale, perma_negative_sum = perma_4 + perma_14 + perma_16)
df_scale$perma_negative_mean <- apply(df_scale[, c("perma_4", "perma_14", "perma_16")], 1, mean)

label(df_scale[["perma_negative_sum"]]) <- "sum of PERMA negative emotion items"
label(df_scale[["perma_negative_mean"]]) <- "mean of PERMA negative emotion items"
```

Health subscale:
```{r}
df_scale <- mutate (df_scale, perma_health_sum = perma_6 + perma_12 + perma_18)
df_scale$perma_health_mean <- apply(df_scale[, c("perma_6", "perma_12", "perma_18")], 1, mean)

label(df_scale[["perma_health_sum"]]) <- "sum of PERMA health items"
label(df_scale[["perma_health_mean"]]) <- "mean of PERMA health items"
```

Loneliness subscale (single item):
```{r}
df_scale <- mutate (df_scale, perma_loneliness_sum = perma_11)
df_scale$perma_loneliness_mean <- df_scale[, c("perma_11")]

label(df_scale[["perma_loneliness_sum"]]) <- "sum of PERMA loneliness items"
label(df_scale[["perma_loneliness_mean"]]) <- "mean of PERMA loneliness items"
```

Add the term variable:
```{r}
df_scale$term <-1
```

Save the data file:
```{r, eval = FALSE}
#Gizem's PC
write.csv(df_scale,'P:/VERSUS (UGS3)/Data/Part 1/PERMA Profiler Term 1.csv')

# Minju's PC
#write.csv(df_scale,'P:\\Emotion Dynamics Lab\\VERSUS (UGS3)\\Data\\Part 1\\PERMA Profiler Term 1.csv')

# Jess's Mac
# write.csv(df_scale,'/Volumes/research/Emotion Dynamics Lab/VERSUS (UGS3)/Data/Part 1/PERMA Profiler Term 1.csv')
```

## Reliability of subscales and the total scale 

Reliability of positive emotions
```{r}
positive <- subset(df_scale, select = c("perma_3","perma_13","perma_22"))
psych::alpha(positive)
```

Reliability of engagement
```{r}
engagement <- subset(df_scale, select = c("perma_2","perma_10","perma_17"))
psych::alpha(engagement)
```

Reliability of relationships
```{r}
relationships <- subset(df_scale, select = c("perma_8","perma_19","perma_21"))
psych::alpha(relationships)
```

Reliability of meaning
```{r}
meaning <- subset(df_scale, select = c("perma_7","perma_9","perma_20"))
psych::alpha(meaning)
```

Reliability of accomplishment
```{r}
accomplishment <- subset(df_scale, select = c("perma_1","perma_5","perma_15"))
psych::alpha(accomplishment)
```

Reliability of overall well-being
```{r}
wellbeing <- subset(df_scale, select = c("perma_3","perma_13","perma_22", "perma_2","perma_10","perma_17","perma_8","perma_19","perma_21","perma_7", "perma_9","perma_20","perma_1","perma_5","perma_15","perma_23"))
psych::alpha(wellbeing)
```

Reliability of negative emotion
```{r}
negative <- subset(df_scale, select = c("perma_4","perma_14","perma_16"))
psych::alpha(negative)
```

Reliability of health
```{r}
health <- subset(df_scale, select = c("perma_6","perma_12","perma_18"))
psych::alpha(health)
```

No calculation of reliability for Loneliness, which consists of a single item.

## Examine the data

Create a new object containing only the subscales (not also the individual items):
```{r}
df <- subset(df_scale, select = c("perma_positive_mean",
                                  "perma_engagement_mean",
                                  "perma_relationships_mean",
                                  "perma_meaning_mean",
                                  "perma_accomplishment_mean",
                                  "perma_wellbeing_mean",
                                  "perma_negative_mean",
                                  "perma_health_mean",
                                  "perma_loneliness_mean"))
```

Get descriptive statistics for each scale:
```{r}
describe(df)
```

Plot histograms of each scale:
```{r}
# melt the data
df_m <- melt(df)

g <- ggplot(df_m,aes(x=value))
g <- g + geom_histogram()
g <- g + facet_wrap(~variable)
g
```

Create a matrix of scatter plots:
```{r}
pairs(~perma_positive_mean + perma_engagement_mean + perma_relationships_mean + perma_meaning_mean + perma_accomplishment_mean + perma_wellbeing_mean + perma_negative_mean + perma_health_mean + perma_loneliness_mean, data=df, main="Scatterplot Matrix of PERMA Profiler Subscales")
```

Compute a correlation matrix and then visualize it, using steps from [this site](http://www.sthda.com/english/wiki/ggcorrplot-visualization-of-a-correlation-matrix-using-ggplot2).
```{r}
res <-cor(df, use = "complete.obs")
ggcorrplot(res, lab = TRUE)
```
