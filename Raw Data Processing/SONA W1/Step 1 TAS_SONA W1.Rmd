---
title: "Step 1 TAS_SONA W1"
author: "Hayleigh Armstrong"
date: "28/10/2025"
output:
  html_document:
    number_sections: yes
    toc: yes
    toc_depth: 3
    toc_float: yes
---

## Preliminary Steps

Load packages:
```{r, warning = FALSE, message = FALSE, include = FALSE}
library(dplyr)
library(tidyverse)
library(Hmisc)
library(psych)
library(ggplot2)
library(ggcorrplot)
library(reshape2)
```

Read in the data:
```{r}
# Hayleigh's Mac:
df <- read.csv("/Volumes/Emotion Dynamics Lab/PEARS/Data/SEEDS/PEARS_SEEDS_Demographics___Daily_Surveys_SONA_W1/SEEDS SONA W1 Demographics ExpiWell Data Cleaned.csv", na.strings=c("","NA"))

```

Subset the data to just the items from the Toronto Alexthymia Scale questionnaire and remove rows that have question headers:
```{r}
tas_scale <- select(df [-c(1,2,3,4),], X.7, X.152:X.171)
head(tas_scale)
```

Rename the items:
```{r}
colnames(tas_scale)[colnames(tas_scale)=="X.7"] <- "id"
colnames(tas_scale)[colnames(tas_scale)=="X.152"] <- "tas_1"
colnames(tas_scale)[colnames(tas_scale)=="X.153"] <- "tas_2"
colnames(tas_scale)[colnames(tas_scale)=="X.154"] <- "tas_3"
colnames(tas_scale)[colnames(tas_scale)=="X.155"] <- "tas_4"
colnames(tas_scale)[colnames(tas_scale)=="X.156"] <- "tas_5"
colnames(tas_scale)[colnames(tas_scale)=="X.157"] <- "tas_6"
colnames(tas_scale)[colnames(tas_scale)=="X.158"] <- "tas_7"
colnames(tas_scale)[colnames(tas_scale)=="X.159"] <- "tas_8"
colnames(tas_scale)[colnames(tas_scale)=="X.160"] <- "tas_9"
colnames(tas_scale)[colnames(tas_scale)=="X.161"] <- "tas_10"
colnames(tas_scale)[colnames(tas_scale)=="X.162"] <- "tas_11"
colnames(tas_scale)[colnames(tas_scale)=="X.163"] <- "tas_12"
colnames(tas_scale)[colnames(tas_scale)=="X.164"] <- "tas_13"
colnames(tas_scale)[colnames(tas_scale)=="X.165"] <- "tas_14"
colnames(tas_scale)[colnames(tas_scale)=="X.166"] <- "tas_15"
colnames(tas_scale)[colnames(tas_scale)=="X.167"] <- "tas_16"
colnames(tas_scale)[colnames(tas_scale)=="X.168"] <- "tas_17"
colnames(tas_scale)[colnames(tas_scale)=="X.169"] <- "tas_18"
colnames(tas_scale)[colnames(tas_scale)=="X.170"] <- "tas_19"
colnames(tas_scale)[colnames(tas_scale)=="X.171"] <- "tas_20"
```

Variables are pulled in as factors and we want to make them numeric values:
```{r}
tas_scale[,paste0("tas_",1:20)] <- lapply(tas_scale[,paste0("tas_",1:20)], as.numeric)
str(tas_scale)
```

Label the items:
```{r}
label(tas_scale[["tas_1"]]) <- "I am confused about what emotion I am feeling"
label(tas_scale[["tas_2"]]) <- "It is difficult for me to find the right words for my feelings"
label(tas_scale[["tas_3"]]) <- "I have physical sensations that even doctors don’t understand"
label(tas_scale[["tas_4"]]) <- "I am able to describe my feelings easily"
label(tas_scale[["tas_5"]]) <- "I prefer to analyze problems rather than just describe them"
label(tas_scale[["tas_6"]]) <- "When I am upset, I don’t know if I am sad, frightened, or angry?"
label(tas_scale[["tas_7"]]) <- "I am often troubled by sensations in my body"
label(tas_scale[["tas_8"]]) <- "I prefer to just let thing happen rather than to understand why they turned out that way"
label(tas_scale[["tas_9"]]) <- "I have feelings that I can’t quite identify"
label(tas_scale[["tas_10"]]) <- "Being in touch with emotions is essential"
label(tas_scale[["tas_11"]]) <- "I find it hard to describe how I feel about people"
label(tas_scale[["tas_12"]]) <- "People tell me to describe my feelings more"
label(tas_scale[["tas_13"]]) <- "I don’t know what’s going on inside me"
label(tas_scale[["tas_14"]]) <- "I often don’t know why I am angry"
label(tas_scale[["tas_15"]]) <- "I prefer to talk to people about their daily lives rather than their feelings"
label(tas_scale[["tas_16"]]) <- "I prefer to watch “light” entertainment shows rather than psychological dramas"
label(tas_scale[["tas_17"]]) <- "It is difficult for me to reveal my innermost feelings, even to close friends"
label(tas_scale[["tas_18"]]) <- "I can feel close to someone, even in moments of silence"
label(tas_scale[["tas_19"]]) <- "I find examination of my feelings useful in solving personal problems"
label(tas_scale[["tas_20"]]) <- "Looking for hidden meanings in in movies or plays distracts from my enjoyment"

# Look at the data
head(tas_scale)
```

Reverse code items 4, 5, 10, 18, and 19
```{r}

tas_scale <- tas_scale %>%
  mutate(
    tas_4 = 6 - tas_4,
    tas_5 = 6 - tas_5,
    tas_10 = 6 - tas_10,
    tas_18 = 6 - tas_18,
    tas_19 = 6 - tas_19,
  )

```

## Calculate the scale

### Calculate standard means and sums

Calculate the sum scores of Toronto Alexthymia Scale and Subscales, in line with the instructions described in (https://contextualscience.org/toronto_alexithymia_scale_tas20)

First, calculate the sum and the mean scores:
```{r}

# Total alexithymia score = sum all subscales
# Scoring range: 20-100 (higher scores = greater challenges)
tas_scale$tas_sum <- apply(tas_scale[,paste0("tas_",1:20)], 1, sum)

tas_scale$tas_mean <- apply(tas_scale[,paste0("tas_",1:20)], 1, mean)

label(tas_scale$tas_sum) <- "sum of tas items"
label(tas_scale$tas_mean) <- "mean of tas items"
```

Calculate sum and mean scores of the 3 subscales:
```{r}

# Factor I: Difficulty identifying feelings (Items 1, 3, 6, 7, 9, 13, 14)
tas_scale$tas_diff_id_sum <- apply(tas_scale[,paste0("tas_", c(1,3,6,7,9,13,14))], 1, sum)
tas_scale$tas_diff_id_mean <- apply(tas_scale[,paste0("tas_", c(1,3,6,7,9,13,14))], 1, mean)

# Factor II:Difficulty describing feelings (Items 2, 4R, 11, 12, 17)
tas_scale$tas_diff_describ_sum <- apply(tas_scale[,paste0("tas_", c(2,4,11,12,17))], 1, sum)
tas_scale$tas_diff_describ_mean <- apply(tas_scale[,paste0("tas_", c(2,4,11,12,17))], 1, mean)

#Factor III: Externally-oriented thinking (Items 5R, 8, 10R, 15, 16, 18R, 19R, 20)
tas_scale$tas_ext_think_sum <- apply(tas_scale[,paste0("tas_", c(5,8,10,15,16,18,19,20))], 1, sum)
tas_scale$tas_ext_think_mean <- apply(tas_scale[,paste0("tas_", c(5,8,10,15,16,18,19,20))], 1, mean)

label(tas_scale$tas_diff_id_sum) <- "sum of difficulty identifying feelings items"
label(tas_scale$tas_diff_id_mean) <- "mean of difficulty identifying feelings items"

label(tas_scale$tas_diff_describ_sum) <- "sum of difficulty describing feelings items"
label(tas_scale$tas_diff_describ_mean) <- "mean of difficulty describing feelings items"

label(tas_scale$tas_ext_think_sum) <- "sum of externally-oriented thinking items"
label(tas_scale$tas_ext_think_mean) <- "mean of externally-oriented thinking items"

```

### Look at missing data - impute means for missing values
```{r}

missing_summary <- tas_scale %>%
  summarise(across(everything(), ~ sum(is.na(.)))) %>%
  pivot_longer(cols = everything(),
               names_to = "variable",
               values_to = "n_missing") %>%
  mutate(pct_missing = round((n_missing / nrow(tas_scale)) * 100, 2)) %>%
  filter(n_missing > 0) %>%
  arrange(desc(pct_missing))

missing_summary
```
Remove unneeded columns, including the ID so it doesn't get used in the mean imputation:
```{r}
# First, pull out the ID column:
tas_scale.na <- tas_scale
id.list <- tas_scale.na$id

# Now remove the columns we don't want to be part of the mean imputation 
tas_scale.na <- subset(tas_scale.na, select= -c(id, tas_sum, tas_mean))

```


Impute the means, using the approach for imputing row means described [here](https://statisticsglobe.com/mean-imputation-for-missing-data/):
```{r}
for(i in 1:nrow(tas_scale.na)) {
  tas_scale.na[i, ][is.na(tas_scale.na[i, ])] <- mean(as.numeric(tas_scale.na[i, ]), na.rm = TRUE)
}
```

Round the values back to whole numbers:
```{r}
tas_scale.na <- round(tas_scale.na, digits=0)
```

Calculate the sum and mean, using the suffix _MI to indicate that these columns have had means imputed:
```{r}
tas_scale.na$tas_sum_MI <- apply(tas_scale.na[,paste0("tas_",1:20)], 1, sum)
tas_scale.na$tas_mean_MI <- apply(tas_scale.na[,paste0("tas_",1:20)], 1, mean)

```

Put the IDs back into the data frame:
```{r}
tas_scale.na$id <- id.list

```

Now we need to merge the imputed cases back into the main data frame. We don't want to end up with duplicate rows of data for the cases that had missing values, so first we will remove these cases from the original data frame:
```{r}
tas_scale2 <- tas_scale[ ! tas_scale$id %in% id.list, ]

```

Now add the newly-imputed cases back into the main data frame:
```{r}
# Create columns in stress_scale that we will merge the mean-imputed data into
tas_scale2$tas_sum_MI <-tas_scale2$stress_sum
tas_scale2$tas_mean_MI <-tas_scale2$stress_mean

# Create empty columns in stress_scale.na for the conventional mean and sum (not MI)
tas_scale.na$tas_sum <-NA
tas_scale.na$tas_mean <-NA

# Order the columns to be consistent for merge
col_order <- c("id", "tas_1", "tas_2", "tas_3", "tas_4", "tas_5", "tas_6", "tas_7", "tas_8", "tas_9", "tas_10","tas_11","tas_12", "tas_13","tas_14","tas_15", "tas_16", "tas_17", "tas_18", "tas_19","tas_20","tas_sum",  "tas_mean", "tas_sum_MI",  "tas_mean_MI")

tas_scale2 <- tas_scale2[, col_order]
tas_scale.na <- tas_scale.na[, col_order]

# Merge the imputed cases back into stress_scale
tas_scale3 <- rbind(tas_scale2, tas_scale.na)

```


Now use [the documentation](https://nihtoolbox.my.salesforce.com/sfc/p/#2E000001H4ee/a/2E000000Ub7C/9UzNbxkwc9khhqKaYkXmAYUVZaniThvUkA16Ddkp6eY) to re-code the sums into T scores (see page 27):

```{r}
describe(stress_scale3$stress_sum)

# The minimum sum score is 19 and the maximum is 50, so we will only recode that range of values from the table in the documentation.

stress_scale3$stress_T[stress_scale3$stress_sum_MI==19] <- 42.0
stress_scale3$stress_T[stress_scale3$stress_sum_MI==20] <- 43.7
stress_scale3$stress_T[stress_scale3$stress_sum_MI==21] <- 45.3
stress_scale3$stress_T[stress_scale3$stress_sum_MI==22] <- 46.9
stress_scale3$stress_T[stress_scale3$stress_sum_MI==23] <- 48.4
stress_scale3$stress_T[stress_scale3$stress_sum_MI==24] <- 49.9
stress_scale3$stress_T[stress_scale3$stress_sum_MI==25] <- 51.5
stress_scale3$stress_T[stress_scale3$stress_sum_MI==26] <- 53
stress_scale3$stress_T[stress_scale3$stress_sum_MI==27] <- 54.5
stress_scale3$stress_T[stress_scale3$stress_sum_MI==28] <- 56.1
stress_scale3$stress_T[stress_scale3$stress_sum_MI==29] <- 57.5
stress_scale3$stress_T[stress_scale3$stress_sum_MI==30] <- 59
stress_scale3$stress_T[stress_scale3$stress_sum_MI==31] <- 60.5
stress_scale3$stress_T[stress_scale3$stress_sum_MI==32] <- 61.9
stress_scale3$stress_T[stress_scale3$stress_sum_MI==33] <- 63.4
stress_scale3$stress_T[stress_scale3$stress_sum_MI==34] <- 64.8
stress_scale3$stress_T[stress_scale3$stress_sum_MI==35] <- 66.2
stress_scale3$stress_T[stress_scale3$stress_sum_MI==36] <- 67.6
stress_scale3$stress_T[stress_scale3$stress_sum_MI==37] <- 69
stress_scale3$stress_T[stress_scale3$stress_sum_MI==38] <- 70.4
stress_scale3$stress_T[stress_scale3$stress_sum_MI==39] <- 71.8
stress_scale3$stress_T[stress_scale3$stress_sum_MI==40] <- 73.1
stress_scale3$stress_T[stress_scale3$stress_sum_MI==41] <- 74.5
stress_scale3$stress_T[stress_scale3$stress_sum_MI==42] <- 75.9
stress_scale3$stress_T[stress_scale3$stress_sum_MI==43] <- 77.4
stress_scale3$stress_T[stress_scale3$stress_sum_MI==44] <- 78.9
stress_scale3$stress_T[stress_scale3$stress_sum_MI==45] <- 80.4
stress_scale3$stress_T[stress_scale3$stress_sum_MI==46] <- 81.9
stress_scale3$stress_T[stress_scale3$stress_sum_MI==47] <- 83.4
stress_scale3$stress_T[stress_scale3$stress_sum_MI==48] <- 84.8
stress_scale3$stress_T[stress_scale3$stress_sum_MI==49] <- 86.0
stress_scale3$stress_T[stress_scale3$stress_sum_MI==50] <- 87.1


```
Participant 6727c70607bba7b951fee668 did not respond to any of the items. Recode their responses to be NA instead of NaN.
```{r}

stress_scale3 <- stress_scale3 %>%
  mutate(across(stress_1:stress_10,
                ~ ifelse(id == "6727c70607bba7b951fee668", NA, .)))

```

Save the data file:
```{r, eval = FALSE}
#Save to Hayleigh's Mac:
write.csv(stress_scale3,'/Volumes/Emotion Dynamics Lab/PEARS/Data/SEEDS/PEARS_SEEDS_Demographics___Daily_Surveys_SONA_W1/SONA W1 Perceived Stress Part 1.csv')

#Save to Jess's Mac:


```

## Examine the Data

### Reliability

```{r, warning = FALSE}
items <- c("stress_1",  "stress_2", "stress_3", "stress_4", "stress_5", "stress_6", "stress_7", "stress_8", "stress_9", "stress_10")

alpha(stress_scale3[,items])
```

### Descriptive statistics
```{r}
describe(stress_scale3$stress_sum_MI)
describe(stress_scale3$stress_mean_MI)
describe(stress_scale3$stress_T)
```

### Histograms

```{r, message = FALSE, warning = FALSE}
qplot(stress_scale3$stress_mean_MI, geom="histogram") 

qplot(stress_scale3$stress_T, geom="histogram")
```

