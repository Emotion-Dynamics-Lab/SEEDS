---
title: "Step 1 Regulation of Emotion Systems Survey"
author: "Hayleigh Armstrong"
date: "Last compiled on `r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document:
    number_sections: yes
    toc: yes
    toc_depth: 3
    toc_float: yes
---

This script will process the data from the SONA W1 Part 1: Regulation of Emotion Systems Survey.

## Preliminary Steps

Load packages:

```{r, warning = FALSE, message = FALSE, include = FALSE}
library(dplyr)
library(tidyverse)
library(Hmisc)
library(psych)
library(ggplot2)
library(ggcorrplot)
library(reshape2)
```

Read in the data:
```{r}
# Hayleigh's Mac: 
df <- read.csv("/Volumes/Emotion Dynamics Lab/PEARS/Data/SEEDS/PEARS_SEEDS_Demographics___Daily_Surveys_SONA_W1/SEEDS SONA W1 Demographics ExpiWell Data Cleaned.csv", na.strings=c("","NA"))

# Jess's Mac
#df <- read.csv("/Volumes/Emotion Dynamics Lab/PEARS/Data/SEEDS/PEARS_SEEDS_Demographics___Daily_Surveys_SONA_W1/SEEDS SONA W1 Demographics ExpiWell Data Cleaned.csv", na.strings=c("","NA"))

```

Subset the data to just the items from the Regulation of Emotion Systems Survey and remove rows that have question headers:
```{r}
df_scale <-  select(df[-c(1,2,3,4),], X.7, X.92:X.115) 
head(df_scale)
```

Rename the items:
```{r}
colnames(df_scale)[colnames(df_scale)=="X.7"] <- "id"
colnames(df_scale)[colnames(df_scale)=="X.92"] <- "ress_1"
colnames(df_scale)[colnames(df_scale)=="X.93"] <- "ress_2"
colnames(df_scale)[colnames(df_scale)=="X.94"] <- "ress_3"
colnames(df_scale)[colnames(df_scale)=="X.95"] <- "ress_4"
colnames(df_scale)[colnames(df_scale)=="X.96"] <- "ress_5"
colnames(df_scale)[colnames(df_scale)=="X.97"] <- "ress_6"
colnames(df_scale)[colnames(df_scale)=="X.98"] <- "ress_7"
colnames(df_scale)[colnames(df_scale)=="X.99"] <- "ress_8"
colnames(df_scale)[colnames(df_scale)=="X.100"] <- "ress_9"
colnames(df_scale)[colnames(df_scale)=="X.101"] <- "ress_10"
colnames(df_scale)[colnames(df_scale)=="X.102"] <- "ress_11"
colnames(df_scale)[colnames(df_scale)=="X.103"] <- "ress_12"
colnames(df_scale)[colnames(df_scale)=="X.104"] <- "ress_13"
colnames(df_scale)[colnames(df_scale)=="X.105"] <- "ress_14"
colnames(df_scale)[colnames(df_scale)=="X.106"] <- "ress_15"
colnames(df_scale)[colnames(df_scale)=="X.107"] <- "ress_16"
colnames(df_scale)[colnames(df_scale)=="X.108"] <- "ress_17"
colnames(df_scale)[colnames(df_scale)=="X.109"] <- "ress_18"
colnames(df_scale)[colnames(df_scale)=="X.110"] <- "ress_19"
colnames(df_scale)[colnames(df_scale)=="X.111"] <- "ress_20"
colnames(df_scale)[colnames(df_scale)=="X.112"] <- "ress_21"
colnames(df_scale)[colnames(df_scale)=="X.113"] <- "ress_22"
colnames(df_scale)[colnames(df_scale)=="X.114"] <- "ress_23"
colnames(df_scale)[colnames(df_scale)=="X.115"] <- "ress_24"
```

Variables are characters and we want to make them numeric values: (removes labels so must be done before)
```{r}

df_scale[,paste0("ress_",1:24)] <- lapply(df_scale[,paste0("ress_",1:24)], as.numeric)
str(df_scale)

```

Label the items:
```{r}
label(df_scale[["ress_1"]]) <- "Thinking repeatedly about what was bothering me"
label(df_scale[["ress_2"]]) <- "Using facial expressions to show that I was upset"
label(df_scale[["ress_3"]]) <- "Thinking of other ways to interpret the situation"
label(df_scale[["ress_4"]]) <- "Acting like I was not upset"
label(df_scale[["ress_5"]]) <- "Vocalizing how I was feeling"
label(df_scale[["ress_6"]]) <- "Focusing on slowing my heart rate and breathing"
label(df_scale[["ress_7"]]) <- "Immediately working on something to keep myself busy"
label(df_scale[["ress_8"]]) <- "Continually thinking about what was bothering me"
label(df_scale[["ress_9"]]) <- "Making sure no one could tell what I was feeling"
label(df_scale[["ress_10"]]) <- "Doing something else to distract myself"
label(df_scale[["ress_11"]]) <- "Letting my emotions show"
label(df_scale[["ress_12"]]) <- "Trying to see the emotional event from a different perspective"
label(df_scale[["ress_13"]]) <- "Pretending I was not upset"
label(df_scale[["ress_14"]]) <- "Going over the emotional event again and again in my mind"
label(df_scale[["ress_15"]]) <- "Looking at the emotional event from a different perspective"
label(df_scale[["ress_16"]]) <- "Trying to slow my heart rate and breathing"
label(df_scale[["ress_17"]]) <- "Engaging in something else to keep busy"
label(df_scale[["ress_18"]]) <- "Hiding my feelings"
label(df_scale[["ress_19"]]) <- "Taking deep breaths"
label(df_scale[["ress_20"]]) <- "Showing my feelings"
label(df_scale[["ress_21"]]) <- "Continually trying to decide what went wrong"
label(df_scale[["ress_22"]]) <- "Engaging in activities to distract myself"
label(df_scale[["ress_23"]]) <- "Identifying different angles to see the situation"
label(df_scale[["ress_24"]]) <- "Decreasing the tension in my body"
# Look at the data
head(df_scale)
```

Convert the "prefer not to respond" options to "NA":
```{r}
df_scale[df_scale == 6] <- NA

```

## Calculate the scales

### Calculate the standard mean and sum of subscales

#### Sum and mean scores of subscale (non-MI + MI). 

Rumination (Non-MI):
```{r}
#Non-MI
df_scale <- mutate(df_scale, ress_rumination_sum = ress_1 + ress_8 + ress_14 + ress_21)

df_scale$ress_rumination_mean <- apply(df_scale[, c("ress_1", "ress_8", "ress_14", "ress_21")], 1, mean)

label(df_scale[["ress_rumination_sum"]]) <- "sum of ress rumination items"
label(df_scale[["ress_rumination_mean"]]) <- "mean of ress rumination items"
```

Rumination (MI)
```{r}
#MI
# Impute missing values for participants who responded to at least 50% of the sub-scale items (2 items).

# First, pull out columns we do not want used in the mean imputation:
# Pull out the id column:
df_scale.na_rum <- df_scale
id.list <- df_scale.na_rum$id
#Remove columns we don't want to include in the mean imputation:
df_scale.na_rum <- subset(df_scale.na_rum, select = -c(id, ress_2:ress_7, ress_9:ress_13, ress_15:ress_20, ress_22:ress_24, ress_rumination_sum, ress_rumination_mean))

#Impute the means, using the approach for imputing row means described [here](https://statisticsglobe.com/mean-imputation-for-missing-data/):

# Count the number of non-missing items per participant
num_items <- ncol(df_scale.na_rum)
min_items_needed <- ceiling(num_items * 0.5)  # at least 50% answered

# Impute row means only for participants who answered >= 50% of items
for(i in 1:nrow(df_scale.na_rum)) {
  non_missing_count <- sum(!is.na(df_scale.na_rum[i, ]))
  
if(non_missing_count >= min_items_needed) {
    # Impute missing values with row mean
    df_scale.na_rum[i, ][is.na(df_scale.na_rum[i, ])] <- mean(as.numeric(df_scale.na_rum[i, ]), na.rm = TRUE)
  } else {
    # If less than 50% answered, set all values to NA
    df_scale.na_rum[i, ] <- NA
  }
}

#Round the values back to whole numbers:
df_scale.na_rum <- round(df_scale.na_rum, digits=0)

#Calculate the sum and mean, using the suffix _MI to indicate that these columns have had means imputed:
df_scale.na_rum$ress_rumination_sum_MI <- apply(df_scale.na_rum[,paste0(c("ress_1", "ress_8", "ress_14", "ress_21"))], 1, sum)
df_scale.na_rum$ress_rumination_mean_MI <- apply(df_scale.na_rum[,paste0(c("ress_1", "ress_8", "ress_14", "ress_21"))], 1, mean)

#Put the IDs back into the data frame:
df_scale.na_rum$id <- id.list

#Put the MI columns back into the original data frame
df_scale$ress_rumination_mean_MI <- df_scale.na_rum$ress_rumination_mean_MI
df_scale$ress_rumination_sum_MI  <- df_scale.na_rum$ress_rumination_sum_MI

```

Engagement (non-MI):
```{r}

df_scale <- mutate(df_scale, ress_engagement_sum = ress_2 + ress_5 + ress_11 + ress_20)

df_scale$ress_engagement_mean <- apply(df_scale[, c("ress_2", "ress_5", "ress_11", "ress_20")], 1, mean)

label(df_scale[["ress_engagement_sum"]]) <- "sum of ress engagement items"
label(df_scale[["ress_engagement_mean"]]) <- "mean of ress engagement items"

```

Engagement (MI)
```{r}
#MI
# Impute missing values for participants who responded to at least 50% of the sub-scale items (2 items).
# ress_2 + ress_5 + ress_11 + ress_20

# First, pull out columns we do not want used in the mean imputation:
# Pull out the id column:
df_scale.na_eng <- df_scale
id.list <- df_scale.na_eng$id
#Remove columns we don't want to include in the mean imputation:
df_scale.na_eng <- subset(df_scale.na_eng, select = -c(id, ress_1, ress_3, ress_4, ress_6:ress_10, ress_12:ress_19, ress_21:ress_24, ress_rumination_sum, ress_rumination_mean, ress_rumination_sum_MI, ress_rumination_mean_MI, ress_engagement_mean, ress_engagement_sum))

#Impute the means, using the approach for imputing row means described [here](https://statisticsglobe.com/mean-imputation-for-missing-data/):

# Count the number of non-missing items per participant
num_items <- ncol(df_scale.na_eng)
min_items_needed <- ceiling(num_items * 0.5)  # at least 50% answered

# Impute row means only for participants who answered >= 50% of items
for(i in 1:nrow(df_scale.na_eng)) {
  non_missing_count <- sum(!is.na(df_scale.na_eng[i, ]))
  
if(non_missing_count >= min_items_needed) {
    # Impute missing values with row mean
    df_scale.na_eng[i, ][is.na(df_scale.na_eng[i, ])] <- mean(as.numeric(df_scale.na_eng[i, ]), na.rm = TRUE)
  } else {
    # If less than 50% answered, set all values to NA
    df_scale.na_eng[i, ] <- NA
  }
}

#Round the values back to whole numbers:
df_scale.na_eng <- round(df_scale.na_eng, digits=0)

#Calculate the sum and mean, using the suffix _MI to indicate that these columns have had means imputed:
df_scale.na_eng$ress_engagement_sum_MI <- apply(df_scale.na_eng[,paste0(c("ress_2", "ress_5", "ress_11", "ress_20"))], 1, sum)
df_scale.na_eng$ress_engagement_mean_MI <- apply(df_scale.na_eng[,paste0(c("ress_2", "ress_5", "ress_11", "ress_20"))], 1, mean)

#Put the IDs back into the data frame:
df_scale.na_eng$id <- id.list

#Put the MI columns back into the original data frame
df_scale$ress_engagement_mean_MI <- df_scale.na_eng$ress_engagement_mean_MI
df_scale$ress_engagement_sum_MI  <- df_scale.na_eng$ress_engagement_sum_MI


```


Reappraisal (non-MI)
```{r}
df_scale <- mutate(df_scale, ress_reappraisal_sum  = ress_3 + ress_12 + ress_15 + ress_23)

df_scale$ress_reappraisal_mean <- apply(df_scale[, c("ress_3", "ress_12", "ress_15", "ress_23")], 1, mean)

label(df_scale[["ress_reappraisal_sum"]]) <- "sum of ress reappraisal items"
label(df_scale[["ress_reappraisal_mean"]]) <- "mean of ress reappraisal items"

```

Reappraisal (MI)
```{r}

#MI
# Impute missing values for participants who responded to at least 50% of the sub-scale items (2 items).
# ress_3 + ress_12 + ress_15 + ress_23

# First, pull out columns we do not want used in the mean imputation:
# Pull out the id column:
df_scale.na_reap <- df_scale
id.list <- df_scale.na_reap$id
#Remove columns we don't want to include in the mean imputation:
df_scale.na_reap <- subset(df_scale.na_reap, select = -c(id, ress_1, ress_2, ress_4:ress_11, ress_13, ress_14, ress_16:ress_22, ress_24, ress_rumination_sum, ress_rumination_mean, ress_rumination_sum_MI, ress_rumination_mean_MI, ress_engagement_mean, ress_engagement_sum, ress_engagement_mean_MI, ress_engagement_sum_MI, ress_reappraisal_mean, ress_reappraisal_sum))

#Impute the means, using the approach for imputing row means described [here](https://statisticsglobe.com/mean-imputation-for-missing-data/):

# Count the number of non-missing items per participant
num_items <- ncol(df_scale.na_reap)
min_items_needed <- ceiling(num_items * 0.5)  # at least 50% answered

# Impute row means only for participants who answered >= 50% of items
for(i in 1:nrow(df_scale.na_reap)) {
  non_missing_count <- sum(!is.na(df_scale.na_reap[i, ]))
  
if(non_missing_count >= min_items_needed) {
    # Impute missing values with row mean
    df_scale.na_reap[i, ][is.na(df_scale.na_reap[i, ])] <- mean(as.numeric(df_scale.na_reap[i, ]), na.rm = TRUE)
  } else {
    # If less than 50% answered, set all values to NA
    df_scale.na_reap[i, ] <- NA
  }
}

#Round the values back to whole numbers:
df_scale.na_reap <- round(df_scale.na_reap, digits=0)

#Calculate the sum and mean, using the suffix _MI to indicate that these columns have had means imputed:
df_scale.na_reap$ress_reappraisal_sum_MI <- apply(df_scale.na_reap[,paste0(c("ress_3", "ress_12", "ress_15", "ress_23"))], 1, sum)
df_scale.na_reap$ress_reappraisal_mean_MI <- apply(df_scale.na_reap[,paste0(c("ress_3", "ress_12", "ress_15", "ress_23"))], 1, mean)

#Put the IDs back into the data frame:
df_scale.na_reap$id <- id.list

#Put the MI columns back into the original data frame
df_scale$ress_reappraisal_mean_MI <- df_scale.na_reap$ress_reappraisal_mean_MI
df_scale$ress_reappraisal_sum_MI  <- df_scale.na_reap$ress_reappraisal_sum_MI

```

Suppression:
```{r}
df_scale <- mutate(df_scale, ress_suppression_sum  = ress_4 + ress_9 + ress_13 + ress_18)

df_scale$ress_suppression_mean <- apply(df_scale[, c("ress_4", "ress_9", "ress_13", "ress_18")], 1, mean)

label(df_scale[["ress_suppression_sum"]]) <- "sum of ress suppression items"
label(df_scale[["ress_suppression_mean"]]) <- "mean of ress suppression items"

```

Relaxation:
```{r}

df_scale <- mutate(df_scale, ress_relaxation_sum  = ress_6 + ress_16 + ress_19 + ress_24)

df_scale$ress_relaxation_mean <- apply(df_scale[, c("ress_6", "ress_16", "ress_19", "ress_24")], 1, mean)

label(df_scale[["ress_relaxation_sum"]]) <- "sum of ress relaxation items"
label(df_scale[["ress_relaxation_mean"]]) <- "mean of ress relaxation items"

```

Distraction:
```{r}

df_scale <- mutate(df_scale, ress_distraction_sum = ress_7 + ress_10 + ress_17 + ress_22)

df_scale$ress_distraction_mean <- apply(df_scale[, c("ress_7", "ress_10", "ress_17", "ress_22")], 1, mean)

label(df_scale[["ress_distraction_sum"]]) <- "sum of ress distraction items"
label(df_scale[["ress_distraction_mean"]]) <- "mean of ress distraction items"

```

Save the data file:
```{r, eval = FALSE}
#Write to Hayleigh's Mac:
write.csv(df_scale,'/Volumes/Emotion Dynamics Lab/PEARS/Data/SEEDS/PEARS_SEEDS_Demographics___Daily_Surveys_SONA_W1/Regulation of Emotion Systems Survey-Part_1.csv')

#Write to Jess's Mac:
#write.csv(df_scale,'/Volumes/Emotion Dynamics Lab/PEARS/Data/SEEDS/PEARS_SEEDS_Demographics___Daily_Surveys_SONA_W1/Regulation of Emotion Systems Survey-Part_1.csv')
```

##Reliability of the subscales 

Reliability of rumination:
```{r}

rumination <- subset(df_scale, select = c("ress_1" ,  "ress_8" , "ress_14" , "ress_21"))

psych::alpha(rumination)

```

Reliability of engagement:
```{r}

engagement <- subset(df_scale, select = c("ress_2" ,  "ress_5" , "ress_11" , "ress_20"))

psych::alpha(engagement)

```

Reliability of reappraisal:
```{r}

reappraisal <- subset(df_scale, select = c("ress_3" ,  "ress_12" , "ress_15" , "ress_23"))

psych::alpha(reappraisal)

```

Reliability of suppression:
```{r}

suppression <- subset(df_scale, select = c("ress_4" ,  "ress_9" , "ress_13" , "ress_18"))

psych::alpha(suppression)

```

Reliability of relaxation:
```{r}

relaxation <- subset(df_scale, select = c("ress_6" ,  "ress_16" , "ress_19" , "ress_24"))

psych::alpha(relaxation)

```

Reliability of distraction:
```{r}

distraction <- subset(df_scale, select = c("ress_7" ,  "ress_10" , "ress_17" , "ress_22"))

psych::alpha(distraction)

```

## Examine the data

Create a new object containing only the subscales:

```{r}
df_1 <- subset(df_scale, select = c("ress_rumination_mean", "ress_engagement_mean" , "ress_reappraisal_mean" , "ress_suppression_mean" , "ress_relaxation_mean" , "ress_distraction_mean"))
```

### Descriptive statistics for subscales

```{r}
# for subscales

describe(df_1)
```

### Histograms

Rumination subscale
```{r, warning = FALSE, message = FALSE}
qplot(df_scale$ress_rumination_mean, geom="histogram") 

```

Engagement subscale
```{r, warning = FALSE, message = FALSE}
qplot(df_scale$ress_engagement_mean, geom="histogram") 

```
Reappraisal subscale
```{r, warning = FALSE, message = FALSE}

qplot(df_scale$ress_reappraisal_mean, geom="histogram") 

```
Suppression subscale
```{r, warning = FALSE, message = FALSE}

qplot(df_scale$ress_suppression_mean, geom="histogram") 

```
Relaxation subscale
```{r, warning = FALSE, message = FALSE}

qplot(df_scale$ress_relaxation_mean, geom="histogram") 

```
Distraction subscale
```{r, warning = FALSE, message = FALSE}

qplot(df_scale$ress_distraction_mean, geom="histogram") 

```
