---
title: "SONA W1 Demographics"
author: "Hayleigh Armstrong"
date: "11/09/2025"
output:
  html_document:
    number_sections: yes
    toc: yes
    toc_depth: 3
    toc_float: yes
---

This script will process the data from the SONA W1 - Demographics Questionnaire.

## Preliminary Steps

Load packages:

```{r, warning = FALSE, message = FALSE, include = FALSE}
library(plyr)
library(dplyr)
library(tidyverse)
library(tibble)
library(Hmisc)
library(psych)
library(ggplot2)
library(ggcorrplot)
library(reshape2)

```

Read in the data:
```{r}
#Hayleigh's Mac:
# df <- read.csv("/Volumes/Emotion Dynamics Lab/PEARS/Data/SEEDS/PEARS_SEEDS_Demographics___Daily_Surveys_SONA_W1/Demographics_SONA_numeric.csv", na.strings=c("","NA"))

# Jess's Mac
# df <- read.csv("/Volumes/Emotion Dynamics Lab/PEARS/Data/SEEDS/PEARS_SEEDS_Demographics___Daily_Surveys_SONA_W1/Demographics_SONA_numeric.csv", na.strings=c("","NA"))
```

Subset the data to just the items from the Demographics Questionnaire and remove rows that have question headers:
```{r}
demo_scale <- subset(df, select = c(X.7, X.13:X.19, X.21:X.47))
# Column X.20 removed because it was blank?
demo_scale <- demo_scale[-c(1,2,3,4),]
head(demo_scale)
```

## Clean up the variables

Rename the items:
```{r}
colnames(demo_scale)[colnames(demo_scale)=="X.7"] <- "id"
colnames(demo_scale)[colnames(demo_scale)=="X.13"] <- "GenderSelfDescribeText"
colnames(demo_scale)[colnames(demo_scale)=="X.14"] <- "GenderTrajectory"
colnames(demo_scale)[colnames(demo_scale)=="X.15"] <- "GenderTrajectoryNeitherCisgenderNorTransgenderText"
colnames(demo_scale)[colnames(demo_scale)=="X.16"] <- "GenderTrajectoryUnsureText"
colnames(demo_scale)[colnames(demo_scale)=="X.17"] <- "GenderBinaryRelation"
colnames(demo_scale)[colnames(demo_scale)=="X.18"] <- "GenderNietherBinaryNorNonbinaryText"
colnames(demo_scale)[colnames(demo_scale)=="X.19"] <- "GenderBinaryRelationUnsureText"

# Column X.20 was deleted as it was blank

colnames(demo_scale)[colnames(demo_scale)=="X.21"] <- "SexualityAsexualAceSpectrum"
colnames(demo_scale)[colnames(demo_scale)=="X.22"] <- "SexualityBisexual"
colnames(demo_scale)[colnames(demo_scale)=="X.23"] <- "SexualityGay"
colnames(demo_scale)[colnames(demo_scale)=="X.24"] <- "SexualityLesbian"
colnames(demo_scale)[colnames(demo_scale)=="X.25"] <- "SexualityPansexual"
colnames(demo_scale)[colnames(demo_scale)=="X.26"] <- "SexualityQueer"
colnames(demo_scale)[colnames(demo_scale)=="X.27"] <- "SexualityStraightHeterosexual"
colnames(demo_scale)[colnames(demo_scale)=="X.28"] <- "SexualityPreferNotToSay"
colnames(demo_scale)[colnames(demo_scale)=="X.29"] <- "SexualitySelfDescribeText"

colnames(demo_scale)[colnames(demo_scale)=="X.30"] <- "BirthMonth"
colnames(demo_scale)[colnames(demo_scale)=="X.31"] <- "BirthYear"

colnames(demo_scale)[colnames(demo_scale)=="X.32"] <- "EthnicityAsian"
colnames(demo_scale)[colnames(demo_scale)=="X.33"] <- "EthnicityBlackAfrican"
colnames(demo_scale)[colnames(demo_scale)=="X.34"] <- "EthnicityHispanicLatino"
colnames(demo_scale)[colnames(demo_scale)=="X.35"] <- "EthnicityIndigenous"
colnames(demo_scale)[colnames(demo_scale)=="X.36"] <- "EthnicityMiddleEasternNorthAfrican"
colnames(demo_scale)[colnames(demo_scale)=="X.37"] <- "EthnicityPacificIslander"
colnames(demo_scale)[colnames(demo_scale)=="X.38"] <- "EthnicityWhiteEuropean"
colnames(demo_scale)[colnames(demo_scale)=="X.39"] <- "EthnicityPreferNotToSay"
colnames(demo_scale)[colnames(demo_scale)=="X.40"] <- "EthnicitySelfDescribeText"

colnames(demo_scale)[colnames(demo_scale)=="X.41"] <- "Ladder"

colnames(demo_scale)[colnames(demo_scale)=="X.42"] <- "Feedback"

colnames(demo_scale)[colnames(demo_scale)=="X.43"] <- "InternationalDomesticStudent"

colnames(demo_scale)[colnames(demo_scale)=="X.44"] <- "UndergradYear"

colnames(demo_scale)[colnames(demo_scale)=="X.45"] <- "PartOrFullTime"

colnames(demo_scale)[colnames(demo_scale)=="X.46"] <- "Faculty"

colnames(demo_scale)[colnames(demo_scale)=="X.47"] <- "GPA"

```

Change/fix responses to be accurate/meaningful:
```{r}
#Change 0 to NA 
demo_scale[demo_scale == 0] <- NA #Note this also changes several '0' responses in the GPA question to NA, will either need workaround or assume that is a 'no response' since I don't think you can be enrolled with a 0 GPA

#Change Gender Identity responses to text 
demo_scale$GenderTrajectory[demo_scale$GenderTrajectory == 1] <- "trans/transgender_category"
demo_scale$GenderTrajectory[demo_scale$GenderTrajectory == 2] <- "cisgender_category"
demo_scale$GenderTrajectory[demo_scale$GenderTrajectory == 3] <- "neither_transgender_nor_cisgender"
demo_scale$GenderTrajectory[demo_scale$GenderTrajectory == 4] <- "unsure_gender_trajectory"
demo_scale$GenderBinaryRelation[demo_scale$GenderBinaryRelation == 1] <- "binary"
demo_scale$GenderBinaryRelation[demo_scale$GenderBinaryRelation == 2] <- "nonbinary"
demo_scale$GenderBinaryRelation[demo_scale$GenderBinaryRelation == 3] <- "niether_binary_nor_nonbinary"
demo_scale$GenderBinaryRelation[demo_scale$GenderBinaryRelation == 4] <- "gender_binary_unsure"


#Change Sexuality responses to text
demo_scale$SexualityAsexualAceSpectrum[demo_scale$SexualityAsexualAceSpectrum == 1] <- "asexual"
demo_scale$SexualityBisexual[demo_scale$SexualityBisexual == 1] <- "bisexual"
demo_scale$SexualityGay[demo_scale$SexualityGay == 1] <- "gay"
demo_scale$SexualityLesbian[demo_scale$SexualityLesbian == 1] <- "lesbian"
demo_scale$SexualityPansexual[demo_scale$SexualityPansexual == 1] <- "pansexual"
demo_scale$SexualityQueer[demo_scale$SexualityQueer == 1] <- "queer"
demo_scale$SexualityStraightHeterosexual[demo_scale$SexualityStraightHeterosexual == 1] <- "straight/heterosexual"
demo_scale$SexualityPreferNotToSay[demo_scale$SexualityPreferNotToSay == 1] <- "Prefer_not_to_say"


#Change Ethnicity responses to text

demo_scale$EthnicityAsian[demo_scale$EthnicityAsian == 1] <- "Asian"
demo_scale$EthnicityBlackAfrican[demo_scale$EthnicityBlackAfrican == 1] <- "Black/African"
demo_scale$EthnicityHispanicLatino[demo_scale$EthnicityHispanicLatino == 1] <- "Hispanic/Latino"
demo_scale$EthnicityIndigenous[demo_scale$EthnicityIndigenous == 1] <- "Indigenous"
demo_scale$EthnicityMiddleEasternNorthAfrican[demo_scale$EthnicityMiddleEasternNorthAfrican == 1] <- "Middle_Eastern/North_African"
demo_scale$EthnicityPacificIslander[demo_scale$EthnicityPacificIslander == 1] <- "Pacific_Islander"
demo_scale$EthnicityWhiteEuropean[demo_scale$EthnicityWhiteEuropean == 1] <- "White/European"
demo_scale$EthnicityPreferNotToSay[demo_scale$EthnicityPreferNotToSay == 1] <- "Prefer_not_to_say"


#Ladder SES Q - Reverse code to match question text, came in backwards
demo_scale$Ladder <- as.numeric(demo_scale$Ladder)
#demo_scale$Ladder[demo_scale$Ladder == 11] <- NA (No prefer not to respond option) 
demo_scale$Ladder <- 11 - demo_scale$Ladder

#Age - Change numbers to match question text, change 'prefer not to respond' to NA
df_scale$Age <- as.numeric(df_scale$Age)
df_scale$Age <- 16 + df_scale$Age
df_scale$Age[df_scale$Age == 36] <- NA

#International or Domestic student status - change prefer not to respond option (3) to NA, Factor and make responses to text
df_scale$InternationalDomesticStudent[df_scale$InternationalDomesticStudent == 3] <- NA
df_scale$InternationalDomesticStudent <- factor(df_scale$InternationalDomesticStudent, levels = c(1,2), labels = c("International", "Domestic"))

#Undergrad Year - Change 'prefer not to respond' option to NA
df_scale$UndergradYear[df_scale$UndergradYear == 6] <- NA

#Part or Full Time student - change prefer not to respond option (3) to NA, Factor and make responses to text
df_scale$PartOrFullTime[df_scale$PartOrFullTime == 3] <- NA
df_scale$PartOrFullTime <- factor(df_scale$PartOrFullTime, levels = c(1,2), labels = c("Part", "Full"))

#Faculty - change prefer not to respond option (8) to NA
demo_scale$Faculty[demo_scale$Faculty == 8] <- NA

#GPA - correct responses to consistent format, use percentage
df_scale$GPA <- sub(',', '.', df_scale$GPA)
df_scale$GPA <- as.numeric(df_scale$GPA)
df_scale$GPA <- round(df_scale$GPA, digits = 1)
#Get list of all unique values:
gpa <- unique(df_scale$GPA)
gpa <- sort(gpa, decreasing = TRUE)
gpa
#GPAs that need to be corrected include the following values in the following manner, following the equivalency table at (https://students.ok.ubc.ca/academic-success/grades-performance/):
df_scale$GPA <- mapvalues(df_scale$GPA, 4.3, 89) 
df_scale$GPA <- mapvalues(df_scale$GPA, 4.0, 86) 
df_scale$GPA <- mapvalues(df_scale$GPA, 3.9, 84) 
df_scale$GPA <- mapvalues(df_scale$GPA, 3.8, 82) 
df_scale$GPA <- mapvalues(df_scale$GPA, 3.7, 80) 
df_scale$GPA <- mapvalues(df_scale$GPA, 3.6, 79)
df_scale$GPA <- mapvalues(df_scale$GPA, 3.5, 78)
df_scale$GPA <- mapvalues(df_scale$GPA, 3.4, 77)
df_scale$GPA <- mapvalues(df_scale$GPA, 3.3, 76)
df_scale$GPA <- mapvalues(df_scale$GPA, 3.0, 73)
df_scale$GPA <- mapvalues(df_scale$GPA, 2.7, 69)
df_scale$GPA <- mapvalues(df_scale$GPA, 2.5, 65)
df_scale$GPA <- mapvalues(df_scale$GPA, 2.4, 64)
df_scale$GPA <- mapvalues(df_scale$GPA, 2.0, 60)
#change non-meaningful responses to NA (assuming 0 is non-response)
df_scale$GPA[df_scale$GPA == 0] <- NA
df_scale$GPA[df_scale$GPA == 123456789.0] <- NA

```

Faculty Question Key:
* 1 = 'Irving K. Barber Faculty of Arts and Social Sciences' 
* 2 = 'Irving K. Barber Faculty of Science' 
* 3 = 'Faculty of Creative and Critical Studies' 
* 4 = 'Okanagan School of Education' 
* 5 = 'School of Engineering' 
* 6 = 'Faculty of Health and Social Development' 
* 7 = 'Faculty of Management' 
* 8 = 'Prefer not to answer'



Participant 633e3bfaffd6a10b33303ef5 responded 'women' to gender question in self describe. Changed to cisgender_woman in proper format to avoid being categorized as GSM, along with other related columns (Participant also reported straight for sexuality)
```{r}
df_scale <- within(df_scale, GenderCisgenderWoman[id == '633e3bfaffd6a10b33303ef5'] <- 'cisgender_woman')
#df_scale <- within(df_scale, GenderIdentity[id == '633e3bfaffd6a10b33303ef5'] <- 'cisgender_woman')
#df_scale <- within(df_scale, GSM[id == '633e3bfaffd6a10b33303ef5'] <- FALSE)
df_scale <- within(df_scale, GenderSelfDescribeText[id == '633e3bfaffd6a10b33303ef5'] <- NA)
df_scale <- within(df_scale, GenderSelfDescribeTF[id == '633e3bfaffd6a10b33303ef5'] <- NA)
```



Concatenate into single column for each multiple response option question:
```{r}

#Gender Identity
df_scale <- df_scale %>%
  unite("GenderIdentity", c("GenderAgender":"GenderPreferNotToAnswer","GenderSelfDescribeText"), sep= "-", 
        remove = FALSE, na.rm = TRUE)

#Sexual Orientation
df_scale <- df_scale %>%
  unite("SexualOrientation", c("SexualityAsexualAceSpectrum":"SexualityPreferNotToAnswer","SexualitySelfDescribeText"), sep= "-", 
        remove = FALSE, na.rm = TRUE)

#Ethnicity
df_scale <- df_scale %>%
  unite("Ethnicity", c("EthnicityWhiteEuropean":"EthnicityPreferNotToAnswer","EthnicitySelfDescribeText"), sep= "-", 
        remove = FALSE, na.rm = TRUE)

```

Make column for GSM variable:
```{r}
df_scale <- df_scale %>%
  add_column(GSM = if_else(.$GenderIdentity %in% "cisgender_man" | .$GenderIdentity %in% "cisgender_woman" & .$SexualOrientation %in% "straight/heterosexual", FALSE, TRUE), .after = "id")

#See how many GSM participants (shows count of # of TRUE values in column)
sum(df_scale$GSM)

```


## Save the file

Save cleaned datasets:
```{r}
#Write to Enya's Mac:
write.csv(df_scale,'/Volumes/Emotion Dynamics Lab/DREAMS (UGS2)/Data/Part 1/Term 1 Data/Demographics Cleaned Full Part 1.csv')

#Second dataset with just one column per question plus GSM:
df_core <- subset(df_scale, select = c(id, GSM, GenderIdentity, SexualOrientation, Ethnicity, Age, ParentalEducation, Ladder, InternationalDomesticStudent, UndergradYear, PartOrFullTime, Faculty, GPA))
write.csv(df_core,'/Volumes/Emotion Dynamics Lab/DREAMS (UGS2)/Data/Part 1/Term 1 Data/Demographics Cleaned Condensed Part 1.csv')

#Write to Jess's Mac: 


```